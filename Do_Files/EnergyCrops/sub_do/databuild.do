***************************************************************************************************************** Patrick R. Gillespie				* Research Officer				* Teagasc, REDP					* Athenry, Co Galway, Ireland			* patrick.gillespie@teagasc.ie	*											********************************************************* RSF Project DAF RSF 07 505 (GO1390)		*											* A micro level analysis of the Irish 	* agri-food sector: lessons and 		* recommendations from Denmark and 	* the Netherlands				*										* Task 4********************************************************** Construct a panel of tillage farms (99 -07)*   using eupanel9907 files and FADN_2 files*   End up with a complete dataset on which you *   can run a model (and maybe redo descriptives)***************************************************************************************************************** Load a blank data set to start from, then append*   each country dataset to the dataset in memory*   and save. Vars and sectors defined in master.do *   are kept, everything else is dropped.*********************************************************use blank, clear*foreach country of global ms {	di "Appending observations from `country'..."	append using "../CountrySTATAFiles/eupanel9907/`country'" 	keep $oldvars	keep if [$sectors]}*sort country region subregion farmcode yeardrop if farmcode >= .drop startsave "../CountrySTATAFiles/databuilds/$dataname.dta", replace***************************************************************************************************************** Load and then save each FADN_2 csv file in Stata * dta format(necessary for merging and appending)********************************************************** Creates a local which gets the names of * all files in the relevant directories******************************************local file: dir "../CountryData/FADN_2/TEAGSC/" files *clear*** Then loop over all those files, loading and saving*   as a dta after renaming a few variables *****************************************************foreach ctry_yr of local file{	local ctry = substr("`ctry_yr'", 1, length("`ctry_yr'") -4) 	insheet using "../CountryData/FADN_2/TEAGSC/`ctry_yr'"	di "Renaming merge vars to match Full Sample.dta"	rename	a1	region	rename	a2	subregion	rename	a24	country	rename	a3	farmcode	rename	k132aa	oilseedrapeuaa	sort country region subregion farmcode year	note: REAG-5818. Intermediate dataset. Contains additional FADN variables to be merged with Full Sample.dta	di "Saving `ctry_yr' as ../CountrySTATAFiles/FADN_2/`ctry'.dta"	save "../CountrySTATAFiles/FADN_2/`ctry'.dta", replace	clear}*** Now load data9907 as the starting dataset then*   append each country~year dataset to the dataset *   in memory, keeping only the vars in `newvars'*   which is defined in master.do****************************************************use "../CountrySTATAFiles/databuilds/$dataname.dta"sort country region subregion farmcode year*foreach ctry_yr of local file{	local ctry = substr("`ctry_yr'", 1, length("`ctry_yr'") -4)  	di "Merging/appending from `ctry'.dta..."	merge 1:1 country region subregion farmcode year using "../CountrySTATAFiles/FADN_2/`ctry'.dta",nonotes nolabel noreport keepusing($newvars) update	drop if [_merge == 2 | _merge == 5]	drop _merge}*drop if farmcode >= .save "../CountrySTATAFiles/databuilds/$dataname.dta", replace********************************************************